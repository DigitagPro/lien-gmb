<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur QR Code GMB</title>
    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyUdF_mBUrpYGhVKTqeoK1mbjceyYpxzI&libraries=places" async defer></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; }
        h2 { color: #333; margin-bottom: 1.5rem; }
        
        /* Style de la barre de recherche Google */
        input { 
            width: 100%; padding: 12px 15px; border: 2px solid #ddd; border-radius: 8px; 
            font-size: 16px; box-sizing: border-box; transition: 0.3s;
        }
        input:focus { border-color: #4285F4; outline: none; }

        #result { margin-top: 25px; display: none; border-top: 1px solid #eee; padding-top: 20px; }
        .place-name { font-weight: bold; font-size: 1.2rem; color: #202124; margin-bottom: 5px; }
        .place-address { color: #5f6368; font-size: 0.9rem; margin-bottom: 20px; }
        
        .qr-container { background: #f8f9fa; padding: 15px; border-radius: 10px; display: inline-block; }
        img { max-width: 100%; height: auto; display: block; margin: 0 auto; }
        
        .btn { display: inline-block; margin-top: 15px; padding: 10px 20px; background-color: #4285F4; color: white; text-decoration: none; border-radius: 50px; font-weight: 500; font-size: 0.9rem; }
        .btn:hover { background-color: #3367d6; }
    </style>
</head>
<body>

<div class="card">
    <h2>üìç G√©n√©rateur d'Avis</h2>
    <p style="color:#666; font-size:0.9rem; margin-bottom: 20px;">Recherchez une entreprise pour g√©n√©rer son QR Code</p>
    
    <input id="autocomplete" placeholder="Entrez le nom de l'entreprise..." type="text" />

    <div id="result">
        <div id="placeName" class="place-name"></div>
        <div id="placeAddress" class="place-address"></div>
        
        <div class="qr-container">
            <img id="qrImage" src="" alt="QR Code" width="200">
        </div>
        <br>
        <a id="reviewLink" class="btn" href="#" target="_blank">Tester le lien</a>
    </div>
</div>

<script>
    // Cette fonction se lance quand l'API Google est charg√©e
    window.onload = function() {
        initAutocomplete();
    };

    function initAutocomplete() {
        const input = document.getElementById("autocomplete");
        
        // Configuration de l'autocompl√©tion
        // On demande √† r√©cup√©rer uniquement le nom, l'adresse et le place_id pour √©conomiser des frais
        const options = {
            fields: ["formatted_address", "geometry", "name", "place_id"],
            strictBounds: false,
        };

        const autocomplete = new google.maps.places.Autocomplete(input, options);

        // √âcouteur d'√©v√©nement : quand l'utilisateur s√©lectionne une adresse
        autocomplete.addListener("place_changed", () => {
            const place = autocomplete.getPlace();

            if (!place.place_id) {
                alert("Veuillez s√©lectionner une entreprise dans la liste d√©roulante.");
                return;
            }

            afficherResultat(place);
        });
    }

    function afficherResultat(place) {
        // 1. Construire le lien d'avis officiel
        const link = `https://search.google.com/local/writereview?placeid=${place.place_id}`;
        
        // 2. G√©n√©rer le QR Code (API gratuite qrserver)
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&color=000000&data=${encodeURIComponent(link)}`;

        // 3. Mettre √† jour l'affichage
        document.getElementById("placeName").innerText = place.name;
        document.getElementById("placeAddress").innerText = place.formatted_address;
        document.getElementById("qrImage").src = qrUrl;
        document.getElementById("reviewLink").href = link;
        
        document.getElementById("result").style.display = "block";
    }
</script>

</body>
</html>
