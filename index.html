<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur Lien GMB</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; text-align: center; }
        input { padding: 10px; width: 80%; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; }
        button { background-color: #ff4b4b; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%; }
        button:hover { background-color: #d43f3f; }
        #result { margin-top: 20px; padding: 15px; border: 1px solid #eee; display: none; background-color: #f9f9f9; border-radius: 8px; }
        .link-box { background: #eee; padding: 10px; word-break: break-all; font-family: monospace; margin: 10px 0; }
        .loading { display: none; color: #666; }
    </style>
</head>
<body>

    <h2>üìç G√©n√©rateur Lien Avis</h2>
    <p>Outil interne pour les commerciaux</p>

    <input type="text" id="nom" placeholder="Nom de l'entreprise (ex: Pizzeria Napoli)">
    <input type="text" id="ville" placeholder="Ville (ex: Lyon)">
    
    <button onclick="trouverLien()">Obtenir le lien</button>
    <p id="loading" class="loading">Recherche en cours...</p>

    <div id="result">
        <h3 id="nomTrouve"></h3>
        <p>Copie ce lien pour le client :</p>
        <div class="link-box" id="lienFinal"></div>
        <a id="boutonTest" href="#" target="_blank" style="display:block; margin-top:10px; color:blue;">üëâ Tester le lien</a>
    </div>

    <script>
        async function trouverLien() {
            // TA CL√â API EST ICI (Visible par tous ceux qui ont le lien)
            const API_KEY = "07d69c13788621a9c084603f0f6f019c48a0061dcc7c050138d208a6bdf227c1";
            
            const nom = document.getElementById('nom').value;
            const ville = document.getElementById('ville').value;
            const resultDiv = document.getElementById('result');
            const loading = document.getElementById('loading');

            if (!nom) { alert("Mets au moins un nom !"); return; }

            // Afficher le chargement
            loading.style.display = "block";
            resultDiv.style.display = "none";

            // On utilise un proxy 'corsproxy.io' car SerpApi bloque parfois les appels directs depuis un navigateur pour s√©curit√©
            const query = encodeURIComponent(nom + " " + ville);
            const url = `https://serpapi.com/search.json?engine=google_maps&q=${query}&api_key=${API_KEY}&type=search`;

            try {
                // Note: Pour GitHub Pages, on appelle directement SerpApi. 
                // Si √ßa bloque, c'est une s√©curit√© navigateur (CORS).
                const response = await fetch(url);
                const data = await response.json();

                let placeId = null;
                let titre = "";

                // Logique de recherche (comme en Python)
                if (data.place_results) {
                    placeId = data.place_results.place_id;
                    titre = data.place_results.title;
                } else if (data.local_results && data.local_results.length > 0) {
                    placeId = data.local_results[0].place_id;
                    titre = data.local_results[0].title;
                }

                if (placeId) {
                    const lien = `https://search.google.com/local/writereview?placeid=${placeId}`;
                    
                    document.getElementById('nomTrouve').innerText = "‚úÖ " + titre;
                    document.getElementById('lienFinal').innerText = lien;
                    document.getElementById('boutonTest').href = lien;
                    
                    resultDiv.style.display = "block";
                } else {
                    alert("Entreprise introuvable ‚ùå");
                }

            } catch (error) {
                console.error(error);
                alert("Erreur de connexion (V√©rifie ta cl√© ou ta connexion)");
            } finally {
                loading.style.display = "none";
            }
        }
    </script>

</body>
</html>
