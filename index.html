<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur Lien GMB</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; text-align: center; }
        input { padding: 10px; width: 80%; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; }
        button { background-color: #ff4b4b; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%; }
        button:hover { background-color: #d43f3f; }
        #result { margin-top: 20px; padding: 15px; border: 1px solid #eee; display: none; background-color: #f9f9f9; border-radius: 8px; }
        .link-box { background: #eee; padding: 10px; word-break: break-all; font-family: monospace; margin: 10px 0; user-select: all; }
        .loading { display: none; color: #666; }
        .error { color: red; display: none; }
    </style>
</head>
<body>

    <h2>üìç Lien Avis Google (Version HTML)</h2>
    <p>Outil interne pour les commerciaux</p>

    <input type="text" id="nom" placeholder="Nom de l'entreprise (ex: Pizzeria Napoli)">
    <input type="text" id="ville" placeholder="Ville (ex: Lyon)">
    
    <button onclick="trouverLien()">Obtenir le lien</button>
    <p id="loading" class="loading">Recherche en cours... (√ßa peut prendre 3-4 sec)</p>
    <p id="errorMessage" class="error"></p>

    <div id="result">
        <h3 id="nomTrouve"></h3>
        <p>Copie ce lien pour le client :</p>
        <div class="link-box" id="lienFinal"></div>
        <a id="boutonTest" href="#" target="_blank" style="display:block; margin-top:10px; color:blue; font-weight:bold;">üëâ Cliquer pour tester le lien</a>
    </div>

    <script>
        async function trouverLien() {
            // TA CL√â
            const API_KEY = "07d69c13788621a9c084603f0f6f019c48a0061dcc7c050138d208a6bdf227c1";
            
            const nom = document.getElementById('nom').value;
            const ville = document.getElementById('ville').value;
            const resultDiv = document.getElementById('result');
            const loading = document.getElementById('loading');
            const errorMsg = document.getElementById('errorMessage');

            if (!nom) { alert("Mets au moins un nom !"); return; }

            // Reset de l'affichage
            loading.style.display = "block";
            resultDiv.style.display = "none";
            errorMsg.style.display = "none";

            // --- LA CORRECTION EST ICI ---
            // 1. On pr√©pare l'URL de SerpApi
            const targetUrl = `https://serpapi.com/search.json?engine=google_maps&q=${encodeURIComponent(nom + " " + ville)}&api_key=${API_KEY}&type=search`;
            
            // 2. On passe par un PROXY (corsproxy.io) pour √©viter le blocage du navigateur
            const proxyUrl = "https://corsproxy.io/?" + encodeURIComponent(targetUrl);

            try {
                const response = await fetch(proxyUrl);
                const data = await response.json();

                // V√©rification si SerpApi renvoie une erreur (cl√© invalide ou quota d√©pass√©)
                if (data.error) {
                    throw new Error("Erreur SerpApi : " + data.error);
                }

                let placeId = null;
                let titre = "";

                if (data.place_results) {
                    placeId = data.place_results.place_id;
                    titre = data.place_results.title;
                } else if (data.local_results && data.local_results.length > 0) {
                    placeId = data.local_results[0].place_id;
                    titre = data.local_results[0].title;
                }

                if (placeId) {
                    const lien = `https://search.google.com/local/writereview?placeid=${placeId}`;
                    
                    document.getElementById('nomTrouve').innerText = "‚úÖ " + titre;
                    document.getElementById('lienFinal').innerText = lien;
                    document.getElementById('boutonTest').href = lien;
                    
                    resultDiv.style.display = "block";
                } else {
                    errorMsg.innerText = "Entreprise introuvable ‚ùå V√©rifie l'orthographe.";
                    errorMsg.style.display = "block";
                }

            } catch (error) {
                console.error(error);
                errorMsg.innerText = "Erreur : " + error.message;
                errorMsg.style.display = "block";
            } finally {
                loading.style.display = "none";
            }
        }
    </script>

</body>
</html>
